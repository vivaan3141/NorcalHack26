<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClarifyEDU | AI Assignment Feedback</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéì</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --muted: #64748b;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            line-height: 1.6;
        }
        .header { text-align: center; margin-bottom: 40px; }
        h1 { color: var(--primary); font-size: 2.8rem; margin-bottom: 5px; letter-spacing: -1px; }
        .gemini-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }
        .gemini-badge span { font-size: 0.9rem; color: var(--muted); font-weight: 500; }
        .gemini-text { font-weight: bold; color: #1e293b; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 20px; }
        .input-group { background: var(--card); padding: 25px; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); }
        label { display: block; font-weight: 700; margin-bottom: 12px; font-size: 0.95rem; color: var(--primary); }
        textarea {
            width: 100%;
            height: 250px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            resize: none;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }
        textarea:focus { outline: none; border-color: var(--primary); }
        .drop-zone {
            border: 2px dashed #cbd5e1;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            background: #f1f5f9;
            margin-top: 15px;
        }
        .drop-zone:hover { border-color: var(--primary); background: #eef2ff; }
        #filePicker { display: none; }
        .file-info { font-size: 0.85rem; color: var(--muted); margin-top: 5px; }
        
        .tone-container { margin-bottom: 20px; text-align: center; }
        select {
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            color: var(--text);
        }

        #auditBtn {
            display: block;
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 25px;
            cursor: pointer;
            transition: all 0.2s;
        }
        #auditBtn:hover { background: var(--primary-hover); transform: translateY(-1px); }
        #auditBtn:disabled { background: #94a3b8; cursor: not-allowed; }
        
        #output {
            margin-top: 40px;
            background: white;
            padding: 30px;
            border-radius: 16px;
            border-left: 8px solid var(--primary);
            display: none;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            white-space: pre-wrap;
        }
        .loading-spinner { font-style: italic; color: var(--primary); text-align: center; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéì Clarify - Education</h1>
        <div class="gemini-badge">
            <span>Powered by</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L14.8 9.2L22 12L14.8 14.8L12 22L9.2 14.8L2 12L9.2 9.2L12 2Z" fill="#4285F4"/>
            </svg>
            <span class="gemini-text">Gemini</span>
        </div>
        <p>Your AI co-pilot for mastering assignments and meeting every rubric goal.</p>
    </div>

    <div class="tone-container">
        <label>Feedback Tone</label>
        <select id="toneSelect">
            <option value="Chill ">Chill </option>
            <option value="Strict ">Strict </option>
            <option value="Technical ">Technical </option>
        </select>
    </div>

    <div class="grid">
        <div class="input-group">
            <label>1. The Assignment Instructions</label>
            <textarea id="promptInput" placeholder="Paste the prompt, rubric, or teacher instructions here..."></textarea>
        </div>
        <div class="input-group">
            <label>2. Your Draft / Project</label>
            <textarea id="workInput" placeholder="Paste your essay, code, or notes here..."></textarea>
            <div class="drop-zone" id="dropZone">
                <span id="fileLabel">üìÅ Upload PDF, DOCX, or TXT</span>
                <input type="file" id="filePicker" accept=".pdf,.docx,.txt">
            </div>
            <div class="file-info" id="fileInfo">No file selected</div>
        </div>
    </div>

    <button id="auditBtn"> Get feedback on your work!</button>
    <div id="output"></div>

    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.run/@google/genai"
      }
    }
    </script>

    <script type="module">
        // Namespace import to handle library exports correctly
        import * as GenAIModule from "@google/genai";

        const API_KEY = "AIzaSyBYxtGKWVKYGTAZbvkdaxlzZ1BvwSGKPq4";

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const dropZone = document.getElementById('dropZone');
        const filePicker = document.getElementById('filePicker');
        const fileInfo = document.getElementById('fileInfo');
        const output = document.getElementById('output');
        const auditBtn = document.getElementById('auditBtn');

        dropZone.onclick = () => filePicker.click();
        filePicker.onchange = () => {
            if (filePicker.files.length) {
                fileInfo.innerText = "Ready to analyze: " + filePicker.files[0].name;
            }
        };

        async function extractText(file) {
            if (file.type === "text/plain") return await file.text();
            if (file.type === "application/pdf") {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let text = "";
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(s => s.str).join(" ") + " ";
                }
                return text;
            }
            if (file.name.endsWith('.docx')) {
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.extractRawText({ arrayBuffer });
                return result.value;
            }
            return "";
        }

        auditBtn.onclick = async () => {
            const prompt = document.getElementById('promptInput').value;
            const tone = document.getElementById('toneSelect').value;
            let work = document.getElementById('workInput').value;

            if (!prompt) return alert("Please paste the assignment instructions.");

            auditBtn.disabled = true;
            output.style.display = "block";
            output.innerHTML = `<div class="loading-spinner"> Clarify is reading your work as a ${tone}...</div>`;

            try {
                if (filePicker.files.length > 0) {
                    work = await extractText(filePicker.files[0]);
                }
                if (!work) throw new Error("Please provide your work via text or file upload.");

                // Use .default.GoogleGenerativeAI to resolve the SyntaxError
                const genAI = new GenAIModule.default.GoogleGenerativeAI(API_KEY);
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

                const finalPrompt = `
                    You are an expert academic assistant acting as a ${tone}.
                    Your goal is to help the student improve their work by comparing it against the instructions provided.

                    INSTRUCTIONS/RUBRIC:
                    ${prompt}

                    STUDENT WORK:
                    ${work}

                    Provide a structured review in Markdown with these sections:
                    1. **Met Requirements** (Highlight what they did WELL)
                    2. **Missing/Weak Elements** (Specific things the prompt asked for that are missing or need detail)
                    3. **Growth Pointers** (8 actionable tips to improve the grade)
                `;

                const result = await model.generateContent(finalPrompt);
                const response = await result.response;
                const text = response.text();

                // Format and display
                output.innerHTML = text
                    .replace(/\n/g, '<br>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            } catch (err) {
                console.error(err);
                output.innerHTML = `<span style="color:red">Error: ${err.message}</span>`;
            } finally {
                auditBtn.disabled = false;
            }
        };
    </script>
</body>
</html>
